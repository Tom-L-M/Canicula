# Canicula (v4.8.X) - Ransomware protection framework for Windows

### Table of Contents:
  - [Installation](#installation)
  - [Protection](#protection)
    - [How it works](#how-it-works)
    - [Activating](#activating)
    - [Customizing](#customizing)
  - [Logs](#logs)
    - [Plaintext](#plaintext)
    - [HTML Reports](#html-reports)
    - [SIEM Integration Logs](#siem-integration-logs)
  - [Backups](#backups)
    - [Managing file backups](#managing-file-backups)
    - [AutoSync](#autosync)
    - [Multi user backups](#multi-user-backups)
  - [Hex Dumps](#hex-dumps)
    - [Dump Modes](#dump-modes)
    - [Generating Hashes](#generating-hashes)
    - [Other Options:](#other-options)
  - [Extras](#extras)
    - [VirusTotal Integration](#virustotal-integration)
    - [Portable Mode](#portable-mode)
    - [Uninstalling the Application](#uninstalling-the-application)
    - [Enabling 'Run On Startup' Mode](#Enabling-'Run-On-Startup'-Mode)
  - [FAQ](#faq)
  - [Warnings and errors:](#warnings-and-errors)

---

## Installation
  1. Access the official [canicula website](https://sirius-canicula.tluchesi.repl.co/)
  2. Download the installer
  3. Click twice to start the installation wizard, and follow the steps.
  4. Done! A shortcut will be created automatically in Desktop, and you can start using the app. 
  5. (To uninstall the application, see [Uninstalling the Application](#uninstalling-the-application))
  
---

## Protection

### How it works
The anti-ransomware protection is based on both IA analysis and decoy system

### Activating
* To activate/deactivate the protection, simply press the `Start`/`Stop` button in the `Status` upper tab

### Customizing
* The `Settings` tab provide protection customization options: 
    * `Process Verification Interval`: Change the number in this field to change the frequency of process analysis on the machine. It is measured in milliseconds, and lower values means higher machine resource usage, but also a higher protection. The recommended value lies between `200` and `300`, to not compromise performance, while still keeping a very high protection level. 
    * `Decoy Verification Interval`: Change the number in this field to change the frequency of the honeypot files verification. It is measured in milliseconds, and lower values means higher machine resource usage, but also a higher protection. As malware encryption is done within milisseconds range, the recommended value lies between `100` and `200`.
    * `Add decoy locations`: Type a folder path in this field, to add a custom decoy file in there and increase security. (Important: unexistent paths will be simply ignored, so be sure that it is typed correctly) (Also Important: If you do not have permission to access a certain folder, creating a decoy in there will generate a [[LOW_PERMISSION_USER]](#warnings-and-errors) error and stop protection).
    * `Remove decoy locations`: Select a path from the dropdown menu and click 'remove', to remove it from the decoys created on protection activation. Customizations made in this field while the protection is active will only be reflected on the next [protection startup](#activating).
    * `Add trusted programs`: Type a program's executable name to add it in a custom whitelist, in case the application is incorrectly recognizing it as malicious. WARNING: Only do this if you are sure about the program's safety.
    * `Remove trusted programs`: Select a path from the dropdown menu and click 'remove', to remove it from the program whitelist on protection activation. Customizations made in this field while the protection is active will only be reflected on the next [protection startup](#activating).

---

## Logs
Logs can be generated in three different formats: `plaintext`, `HTML`, and `SIEM-integration plaintext`.

### Plaintext
The plaintext generated logs are the application's default, and are displayed in the `Logs` tab. To download the current log file, click on the 'Download' button and type or paste a folder path as destination.

### HTML Reports
HTML Reports can be generated on demand, by clicking on the HTML Document icon. The report will not be downloaded, instead it will be opened on the default browser, and from there it can be downloaded using the browser-specific configurations, or printing.

### SIEM Integration Logs
To allow the integration of SIEM softwares and response to event detection, and automatic event log file is generated using [Elastic](https://www.elastic.co/pt/) formatting. To integrate the two services, simply feed the SIEM platform with the proper logs generated by canicula. To download the SIEM-friendly file, click on the 'SIEM' icon and type or paste a folder path as destination. Alternatively, you can reach the log files by accessing the path `<installation_path>/canicula/application/log/`, ehere the SIEM-friendly file is `log_siem.candata`.

---

## Backups

### Managing file backups
Backups work under a path definition directive, which means the are binded to existing files, instead of virtual paths. 
* **Adding Files:** Select a file in the proper field, and click `Add` to add it to the backup pool. A precise copy of this file will be stored. 
* **Syncing Files:** To force the syncing of a file in the backup pool, select the file in the proper field, and click `Sync`, and the file's contents in the backup pool will be updated.
* **Removing Files:** To remove a file from the backup pool, use the file field to select the original file that is in the pool and click `Remove`.
* **Restore File:**  Select a file in the proper field, and click `Restore` to restore it's data from the backup pool. This will override the original file, and restire the data stored in the counterpart in the pool.
* **Syncing All Files:** This option does not need a file to be selected first, and forces the sinchronization of all files in the backup pool, with their counterpart in the computer.
* **Removing All Files:** This option removes all the backup files in the pool. Warning: this action is irreversible, but will not affect the original files, only their counterpart in backup pool.

### AutoSync
AutoSync option allows for automatic synchronization of files in backup pool on app startup, which means when tha application is started, all files in backup pool will be overriden, be careful and only turn this option ON in an secure environment.

### Multi user backups
By default, the backup pool is divided in user folders, to allow multi-user and portable executions. This means files that were added to backup pool by an user will not be displayed and cannot be edited by other users, increasing privacy. But, the total backup size shown in the `info` section, includes the files backed up by all users.

---

## Hex Dumps
The `Dump` tab allows for windows executable (PE files) hexadecimal dumping. Select a PE file, an output file and a dump mode, and press `Generate Dump`. (Important: depending on the file size, this may take some time)

### Dump Modes

* **Simple:** Returns the default dumping pattern: Hexadecimal offsets, hex bytes, and the bytes converted to ASCII encoding.
* **Formatted:** Returns the default dumping pattern, with formatting headers: Hexadecimal offsets, hex bytes, and the bytes converted to ASCII encoding.
* **Raw Hex Bytes:** Returns only the raw hex bytes from the file. Separated by spaces and in 16-byte lines.
* **ASCII Bytes:** Returns only the bytes converted to ASCII encoding, in 16-byte lines.
* **Strings:** Returns all the strings found in teh executable file. The string-finding pattern includes strings with length 4 or more, including the alphabet letters in lower and upper case, plus `_` and `$`.

### Generating Hashes
Select an Windows executable file in the `File to Dump` field, and click `Generate Hash` button, to generate the SHASUM (SHA 256 hash) of the selected file.

### Other Options:
* **Open Dump:** Select a file in the `Output File` field, and click `Open Dump` to open a dump file with `notepad.exe`. 
* **Search On Web:** Select an Windows executable file in the `File to Dump` field, and click `Search on Web` to search for the file's name in the default browser.

---

## Extras

### VirusTotal Integration
As the default hash of used in the VirusTotal service is SHA256, the hashes generated from files with the app can be inputed to [VirusTotal](https://www.virustotal.com/gui/home/search) in order to search for vendor analysis of the file.

### Portable Mode
As the application is self-contained, it can be installed as portable just by extracting its folder into an portable storage device. 

### Uninstalling the Application
To uninstall the app, stop any running services and then go to the Start Menu, or the Application Manager, click on the app with the mouse right button and select the "Uninstall" option.

### Enabling 'Run On Startup' Mode
To enable the app to autostart with the machine startup, follow these steps: 
  - (To start the app, but not the protection service, simply remove the '--autostart' flag from the snippets below)


1. Create a custom shortcut to the application, or copy the one generated on Desktop.
2. Configure the shortcut:
   1. 'Target' property set to [ "Your-Installation-Path\canicula\application\canicula.exe" --autostart ]. 
       - (EX: "C:\Program Files (x86)\canicula\application\canicula.exe" --autostart)
   2. 'Start in' property set to [  "Your-Installation-Path\canicula\application" ]
3. To enable Run On Startup for all users:
   - Type `Windows + r ` and then `Shell:Commom Startup` (or go to `C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp`) and move the custom shortcut in there
4. To enable Run On Startup for the current user:
   - Type `Windows + r ` and then `Shell:Startup`, and move the custom shortcut in there

---

## FAQ
* **The application just disappeared?**

Some anti-virus softwares may incorrectly label the application as malware, and therefore delete its executable file. There is no permanent fix for this, as third-party software may or may not accept the app as secure. But it is possible to fix this for the current machine by following these steps:
1. First, uninstall the application, as it is already incomplete because of anti-virus file deletion.
2. Go to the path where you want to install the application, and create a folder called `user_secure`
3. Access your anti-virus software and add the recently created `user_secure` folder to the verification exclusions. (This will force the anti-virus to not search for malware in this folder).
4. Reinstall the application in this folder.

---

## Warnings and errors:
* **[LOW_PERMISSION_USER]:**
    * **Cause**: This warning indicates that the program is running under a low-permission environment or context
    * **Consequences**: This may generate permission-related errors on backup deleting and protection activation/deactivation.
    * **Workarounds**: 
        * Start the application as Administrator.
        * Access the `Settings` tab, and in the `Remove Decoy Locations` option, select and remove the following paths (if present): `C:\`, `C:\Users`, `C:\Program Files`, `C:\Program Files (x86)`, `C:\Program Files\Common Files` and `C:\Program Files (x86)\Common Files` (and any other path that points to a folder where you would need administrator rights to create a hidden file).
        * If nothing works, check with your system administrator to change the user permissions and allow the app to run properly.